<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Grelien: Storage Management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Grelien
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Storage Management</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga973715a384f1e51b7b8993bdbed15a3b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Storage.html#ga973715a384f1e51b7b8993bdbed15a3b">init_nvs</a> (void)</td></tr>
<tr class="memdesc:ga973715a384f1e51b7b8993bdbed15a3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize NVS storage system.  <a href="group__Storage.html#ga973715a384f1e51b7b8993bdbed15a3b">More...</a><br /></td></tr>
<tr class="separator:ga973715a384f1e51b7b8993bdbed15a3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8e470dddd9c49dad31fe155e6eff9fbc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Storage.html#ga8e470dddd9c49dad31fe155e6eff9fbc">load_settings</a> (void)</td></tr>
<tr class="memdesc:ga8e470dddd9c49dad31fe155e6eff9fbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load device settings and schedules from NVS.  <a href="group__Storage.html#ga8e470dddd9c49dad31fe155e6eff9fbc">More...</a><br /></td></tr>
<tr class="separator:ga8e470dddd9c49dad31fe155e6eff9fbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2ea83bdac732caa4f9cb7806d0d34d79"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Storage.html#ga2ea83bdac732caa4f9cb7806d0d34d79">save_settings</a> (void)</td></tr>
<tr class="memdesc:ga2ea83bdac732caa4f9cb7806d0d34d79"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save device settings and schedules to NVS.  <a href="group__Storage.html#ga2ea83bdac732caa4f9cb7806d0d34d79">More...</a><br /></td></tr>
<tr class="separator:ga2ea83bdac732caa4f9cb7806d0d34d79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gafd45f9e5ac12f008aa62728519ed4bd6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Storage.html#gafd45f9e5ac12f008aa62728519ed4bd6">save_history_to_flash</a> (void)</td></tr>
<tr class="memdesc:gafd45f9e5ac12f008aa62728519ed4bd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save schedule execution history to NVS.  <a href="group__Storage.html#gafd45f9e5ac12f008aa62728519ed4bd6">More...</a><br /></td></tr>
<tr class="separator:gafd45f9e5ac12f008aa62728519ed4bd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaad68423f26904e60af5372e60d0df6f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Storage.html#gaad68423f26904e60af5372e60d0df6f5">load_history_from_flash</a> (void)</td></tr>
<tr class="memdesc:gaad68423f26904e60af5372e60d0df6f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load schedule execution history from NVS.  <a href="group__Storage.html#gaad68423f26904e60af5372e60d0df6f5">More...</a><br /></td></tr>
<tr class="separator:gaad68423f26904e60af5372e60d0df6f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadfa5a5d4d22b0fd6e9eddfeb4ff74d9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Storage.html#gadfa5a5d4d22b0fd6e9eddfeb4ff74d9f">save_time_to_flash</a> (void)</td></tr>
<tr class="memdesc:gadfa5a5d4d22b0fd6e9eddfeb4ff74d9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Save current system time to NVS.  <a href="group__Storage.html#gadfa5a5d4d22b0fd6e9eddfeb4ff74d9f">More...</a><br /></td></tr>
<tr class="separator:gadfa5a5d4d22b0fd6e9eddfeb4ff74d9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6d1ab41537e4ba04a6338bdd3374618f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Storage.html#ga6d1ab41537e4ba04a6338bdd3374618f">restore_time_from_flash</a> (void)</td></tr>
<tr class="memdesc:ga6d1ab41537e4ba04a6338bdd3374618f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Restore system time from NVS.  <a href="group__Storage.html#ga6d1ab41537e4ba04a6338bdd3374618f">More...</a><br /></td></tr>
<tr class="separator:ga6d1ab41537e4ba04a6338bdd3374618f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga973715a384f1e51b7b8993bdbed15a3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga973715a384f1e51b7b8993bdbed15a3b">&#9670;&nbsp;</a></span>init_nvs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_nvs </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize NVS storage system. </p>
<p>Initialize the Non-Volatile Storage (NVS) system.</p>
<p>Initializes the ESP32 NVS flash storage and opens a handle for the motor scheduler namespace. If NVS is corrupted or incompatible, it will be erased and reinitialized. This function must be called before any other storage operations.</p>
<dl class="section note"><dt>Note</dt><dd>This function will cause a system restart if NVS initialization fails </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Storage__Management.html#ga8e470dddd9c49dad31fe155e6eff9fbc" title="Load device settings and schedules from NVS.">load_settings()</a>, <a class="el" href="group__Storage__Management.html#ga2ea83bdac732caa4f9cb7806d0d34d79" title="Save current device settings and schedules to NVS.">save_settings()</a> </dd></dl>

</div>
</div>
<a id="gaad68423f26904e60af5372e60d0df6f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaad68423f26904e60af5372e60d0df6f5">&#9670;&nbsp;</a></span>load_history_from_flash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_history_from_flash </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load schedule execution history from NVS. </p>
<p>Restores previously saved schedule execution history, maintaining continuity across system reboots. </p>

</div>
</div>
<a id="ga8e470dddd9c49dad31fe155e6eff9fbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8e470dddd9c49dad31fe155e6eff9fbc">&#9670;&nbsp;</a></span>load_settings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void load_settings </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Load device settings and schedules from NVS. </p>
<p>Retrieves all stored device settings including device name, location, and all scheduled motor operations from NVS flash storage. If data is corrupted or missing, appropriate defaults are used. Schedule count is validated to prevent buffer overflows.</p>
<dl class="section note"><dt>Note</dt><dd>Should be called during system initialization after <a class="el" href="group__Storage.html#ga973715a384f1e51b7b8993bdbed15a3b" title="Initialize NVS storage system.">init_nvs()</a> </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Storage.html#ga2ea83bdac732caa4f9cb7806d0d34d79" title="Save device settings and schedules to NVS.">save_settings()</a>, <a class="el" href="group__Storage.html#ga973715a384f1e51b7b8993bdbed15a3b" title="Initialize NVS storage system.">init_nvs()</a> </dd></dl>

</div>
</div>
<a id="ga6d1ab41537e4ba04a6338bdd3374618f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6d1ab41537e4ba04a6338bdd3374618f">&#9670;&nbsp;</a></span>restore_time_from_flash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void restore_time_from_flash </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Restore system time from NVS. </p>
<p>Attempts to restore previously saved time if network synchronization is not available. Used as fallback time source. </p>

</div>
</div>
<a id="gafd45f9e5ac12f008aa62728519ed4bd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gafd45f9e5ac12f008aa62728519ed4bd6">&#9670;&nbsp;</a></span>save_history_to_flash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void save_history_to_flash </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Save schedule execution history to NVS. </p>
<p>Persists the current schedule execution history array, allowing history to survive system reboots. </p>

</div>
</div>
<a id="ga2ea83bdac732caa4f9cb7806d0d34d79"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2ea83bdac732caa4f9cb7806d0d34d79">&#9670;&nbsp;</a></span>save_settings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void save_settings </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Save device settings and schedules to NVS. </p>
<p>Save current device settings and schedules to NVS.</p>
<p>Stores all current device settings including device name, location, and all motor schedules to NVS flash storage. Data is committed to ensure immediate persistence. Individual schedule save failures are logged but don't prevent other schedules from being saved.</p>
<dl class="section note"><dt>Note</dt><dd>This function should be called whenever settings are modified </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Storage__Management.html#ga8e470dddd9c49dad31fe155e6eff9fbc" title="Load device settings and schedules from NVS.">load_settings()</a>, <a class="el" href="group__Storage__Management.html#gafd45f9e5ac12f008aa62728519ed4bd6" title="Save schedule execution history to NVS.">save_history_to_flash()</a> </dd></dl>

</div>
</div>
<a id="gadfa5a5d4d22b0fd6e9eddfeb4ff74d9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadfa5a5d4d22b0fd6e9eddfeb4ff74d9f">&#9670;&nbsp;</a></span>save_time_to_flash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void save_time_to_flash </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Save current system time to NVS. </p>
<p>Stores the current time for restoration after reboot when network time synchronization may not be immediately available. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
