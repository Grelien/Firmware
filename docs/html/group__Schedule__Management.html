<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Grelien: Schedule Management Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Grelien
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Schedule Management Functions</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions for managing motor schedules and execution history.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6f6409385677dd94d04e999017ee71b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Schedule__Management.html#ga6f6409385677dd94d04e999017ee71b0">add_to_history</a> (const char *schedule_name, const char *action)</td></tr>
<tr class="memdesc:ga6f6409385677dd94d04e999017ee71b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an entry to the schedule execution history.  <a href="group__Schedule__Management.html#ga6f6409385677dd94d04e999017ee71b0">More...</a><br /></td></tr>
<tr class="separator:ga6f6409385677dd94d04e999017ee71b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaccfbb70299f2c744b57e76a32875bfe9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Schedule__Management.html#gaccfbb70299f2c744b57e76a32875bfe9">check_schedules</a> (void)</td></tr>
<tr class="memdesc:gaccfbb70299f2c744b57e76a32875bfe9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check and execute scheduled motor operations.  <a href="group__Schedule__Management.html#gaccfbb70299f2c744b57e76a32875bfe9">More...</a><br /></td></tr>
<tr class="separator:gaccfbb70299f2c744b57e76a32875bfe9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Functions for managing motor schedules and execution history. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga6f6409385677dd94d04e999017ee71b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6f6409385677dd94d04e999017ee71b0">&#9670;&nbsp;</a></span>add_to_history()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_to_history </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>schedule_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>action</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an entry to the schedule execution history. </p>
<p>Records when a schedule action (ON/OFF) occurs, maintaining a history of motor operations. Handles both start and end events for schedules.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">schedule_name</td><td>Name of the schedule being executed </td></tr>
    <tr><td class="paramname">action</td><td>Action performed ("ON" or "OFF")</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The function automatically manages history array bounds and shifts older entries when the maximum is reached.</dd></dl>
<p>Add an entry to the schedule execution history.</p>
<p>Records schedule events (start/stop) in the history array with timestamps. Manages history array overflow by shifting older entries. For "ON" events, prevents duplicate active entries for the same schedule. For "OFF" events, updates the end time of matching active entries.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">schedule_name</td><td>Name of the schedule that triggered the event </td></tr>
    <tr><td class="paramname">action</td><td>Action performed ("ON" or "OFF")</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>History is automatically saved to flash storage after each addition </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Storage.html#gafd45f9e5ac12f008aa62728519ed4bd6" title="Save schedule execution history to NVS.">save_history_to_flash()</a> </dd></dl>

</div>
</div>
<a id="gaccfbb70299f2c744b57e76a32875bfe9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaccfbb70299f2c744b57e76a32875bfe9">&#9670;&nbsp;</a></span>check_schedules()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void check_schedules </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check and execute scheduled motor operations. </p>
<p>Examines all enabled schedules and executes any that match the current time. Handles both start and end times for schedules, and manages one-time vs. daily repeating schedules.</p>
<dl class="section note"><dt>Note</dt><dd>This function should be called periodically (recommended every 30 seconds) to ensure schedules are executed on time.</dd></dl>
<p>Periodically checks all enabled schedules against current time and executes motor operations when scheduled times are reached. Handles missed events by checking all minutes since last execution. Supports one-time and daily repeat schedules.</p>
<p>The function maintains state to prevent duplicate executions and handles schedule lifecycle (disabling one-time schedules after completion).</p>
<dl class="section note"><dt>Note</dt><dd>Should be called regularly (e.g., every minute) from main loop </dd>
<dd>
First call initializes the checking mechanism without executing schedules </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Motor__Control.html#ga464415ba555c0bcab1f9b262bd8167f0" title="Turn the motor ON.">motor_on()</a>, <a class="el" href="group__Motor__Control.html#ga754e0993eea9785f729c9cfe486fba02" title="Turn the motor OFF safely.">motor_off()</a>, <a class="el" href="group__Schedule__Management.html#ga6f6409385677dd94d04e999017ee71b0" title="Add a schedule event to history.">add_to_history()</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
